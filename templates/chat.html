<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <style>
        /* Styles pour l'espace conversationnel */
        #chatHistory {
            width: 100%;
            height: 300px;
            border: 1px solid #ccc;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9f9f9;
        }

        /* Styles pour le formulaire */
        .form-container {
            display: flex;
            align-items: center;
        }

        .form-container input[type="text"],
        .form-container textarea {
            margin-right: 10px;
            width: 20%;
        }

        .form-container textarea {
            flex-grow: 1;
        }

        .form-container label {
            margin-right: 5px;
        }

        .form-container .sentiment-options {
            margin-right: 10px;
        }

        .form-container button {
            margin-left: 10px;
        }

        /* Styles pour les messages */
        .message {
            padding: 5px;
            margin-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .message strong {
            color: #333;
        }

        .message time {
            color: #777;
            font-size: 0.9em;
        }
    </style>
    <script>
        function checkForm() {
            const username = document.getElementById('username').value;
            const message = document.getElementById('messageContent').value;
            const sentiment = document.querySelector('input[name="sentiment"]:checked');
            document.getElementById('submitBtn').disabled = !(username && message && sentiment);
        }

        function sendMessage() {
            const username = document.getElementById('username').value;
            const message = document.getElementById('messageContent').value;
            const sentiment = document.querySelector('input[name="sentiment"]:checked').value;

            // Envoyer les données au serveur
            fetch('/send-message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, message, sentiment })
            })
            .then(response => response.json())
            .then(data => {
                // Ajouter le nouveau message directement dans la zone de chat
                const chatHistory = document.getElementById('chatHistory');
                const newMessage = `
                    <div class="message">
                        <strong>${username}</strong>: ${message}
                    </div>`;
                chatHistory.innerHTML += newMessage;

                // Faire défiler l'historique jusqu'au bas
                chatHistory.scrollTop = chatHistory.scrollHeight;

                // Réinitialiser le formulaire
                document.getElementById('messageForm').reset();
                document.getElementById('submitBtn').disabled = true;
            })
            .catch(error => {
                alert('Erreur lors de l\'envoi du message');
            });
        }

        function loadChatHistory() {
            fetch('/chat-history')
            .then(response => response.json())
            .then(data => {
                const chatHistory = document.getElementById('chatHistory');
                chatHistory.innerHTML = '';
                data.messages.forEach(msg => {
                    chatHistory.innerHTML += `
                        <div class="message">
                            <strong>${msg.username}</strong> (${msg.time}): ${msg.message}
                        </div>`;
                });
            });
        }

        window.onload = loadChatHistory;
    </script>
</head>
<body>
    <h1>Chat</h1>

    <!-- Espace conversationnel pour les messages -->
    <div id="chatHistory"></div>

    <!-- Formulaire d'envoi de message -->
    <form id="messageForm" class="form-container">
        <label for="username">Nom d'utilisateur :</label>
        <input type="text" id="username" name="username" oninput="checkForm()">

        <label for="messageContent">Message :</label>
        <textarea id="messageContent" name="message" rows="2" oninput="checkForm()"></textarea>

        <div class="sentiment-options">
            <label>Sentiment :</label>
            <input type="radio" id="positif" name="sentiment" value="1" onclick="checkForm()">
            <label for="positif">Positif</label>
            <input type="radio" id="negatif" name="sentiment" value="0" onclick="checkForm()">
            <label for="negatif">Négatif</label>
        </div>

        <button type="button" id="submitBtn" disabled onclick="sendMessage()">Envoyer</button>
    </form>
</body>
</html>
